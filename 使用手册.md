# 📖 2Pass 密码管理器 - 完整使用手册

> 这是一个使用 Tauri + React 构建的安全、现代化的密码管理应用

---

## 目录

1. [功能概览](#功能概览)
2. [快速开始](#快速开始)
3. [密码管理](#密码管理)
4. [TOTP 功能](#totp-功能)
5. [侧边栏使用](#侧边栏使用)
6. [故障排除](#故障排除)
7. [技术说明](#技术说明)

---

## 功能概览

### ✨ 核心功能

- 🔐 **密码管理** - 添加、编辑、删除、搜索密码
- 🎯 **拖动排序** - 自由调整密码卡片顺序
- ⏱️ **TOTP 支持** - Google Authenticator 二次验证
- 🔗 **组合密码** - 自动组合密码和验证码
- 🎲 **密码生成器** - 生成强密码
- 📱 **可拖动侧边栏** - 自定义界面布局
- 🔒 **AES-256 加密** - 军事级数据保护
- 💾 **本地存储** - 数据不上传云端

### 🎯 版本信息

- **当前版本**: v1.2.0
- **更新日期**: 2025-11-05
- **支持平台**: macOS, Windows, Linux

---

## 快速开始

### 安装和启动

```bash
# 进入项目目录
cd 2pass

# 开发模式
pnpm tauri dev

# 生产构建
pnpm tauri build
```

### 首次使用

1. **创建主密码**
   - 启动应用后首次使用需要创建主密码
   - 主密码至少 8 个字符
   - ⚠️ 请牢记主密码，丢失后无法恢复！

2. **了解界面**
   - 左侧：侧边栏菜单
   - 右侧：主内容区域
   - 点击菜单切换不同视图

3. **添加第一个密码**
   - 点击"➕ 添加密码"按钮
   - 填写标题、用户名、密码等信息
   - 点击保存

---

## 密码管理

### 添加密码

1. 点击"➕ 添加密码"
2. 填写必填字段：
   - **标题** *（必填）- 如：Gmail、银行账户
   - **用户名** *（必填）- 用户名或邮箱
   - **密码** *（必填）- 密码内容
3. 可选字段：
   - **网址** - 网站地址
   - **备注** - 其他说明
4. 点击"💾 保存"

### 编辑密码

1. 在密码卡片上点击"✏️"按钮
2. 修改需要更改的字段
3. 点击"💾 保存"

### 删除密码

1. 在密码卡片上点击"🗑️"按钮
2. 确认删除操作

### 搜索密码

在顶部搜索框输入关键词，支持搜索：
- 标题
- 用户名
- 网址

### 拖动排序

**调整密码卡片顺序**：

1. **查看拖动图标**
   - 鼠标悬停在密码卡片上
   - 左上角会出现 ⋮⋮ 图标

2. **拖动卡片**
   - 按住卡片任意位置
   - 拖动到目标位置
   - 松开鼠标完成排序

3. **视觉反馈**
   - 拖动时：卡片半透明
   - 目标位置：蓝色虚线边框
   - 光标：抓手图标（grab/grabbing）

4. **自动保存**
   - 排序后自动保存
   - 下次打开保持顺序

**注意**：
- ⚠️ 搜索状态下不能拖动（避免混乱）
- 💡 清除搜索框即可恢复拖动功能

### 查看/复制密码

- **查看密码**：点击 👁️ 显示，点击 🙈 隐藏
- **复制用户名**：点击用户名旁的 📋
- **复制密码**：点击密码旁的 📋

### 使用密码生成器

在添加/编辑密码时：
1. 点击密码输入框旁的"🎲"按钮
2. 调整参数：
   - 长度：8-32 字符
   - 字符类型：大写/小写/数字/符号
3. 点击"生成密码"
4. 点击"✓ 使用此密码"

---

## TOTP 功能

### 什么是 TOTP？

TOTP (Time-based One-Time Password) 是一种动态验证码，每 30 秒更新一次，用于增强账户安全性。

### 什么是组合密码？

**组合密码** = 你的密码 + TOTP 验证码

例如：
- 密码：`MyPass123`
- 验证码：`456789`
- 组合密码：`MyPass123456789`

### 配置 TOTP

#### 方法 1：自动生成（推荐）

1. 添加/编辑密码时，点击"➕ 添加 TOTP"
2. 点击"🔑 生成密钥"
3. 用手机上的 Google Authenticator 扫描二维码
4. 点击"🧪 生成测试验证码"验证配置
5. 点击"💾 保存配置"
6. 保存密码条目

#### 方法 2：手动输入

1. 点击"✍️ 手动输入密钥"
2. 输入 Base32 格式的密钥（如：`JBSWY3DPEHPK3PXP`）
3. 点击"应用"
4. 其他步骤同上

### 使用 TOTP

配置后，在密码卡片中会看到：

```
┌─────────────────────────────────┐
│ TOTP 验证码                     │
│ 456789              📋         │
│ ▓▓▓▓▓▓▓▓░░░░ 18s              │
├─────────────────────────────────┤
│ 🔗 组合密码（密码+验证码）      │
│ •••••••••••••• 👁️ 📋         │
└─────────────────────────────────┘
```

**操作**：
- 点击 TOTP 旁的 📋 → 复制验证码
- 点击组合密码的 👁️ → 显示/隐藏
- 点击组合密码的 📋 → 复制组合密码

### TOTP 使用场景

#### 场景 1：标准网站（Google、GitHub 等）

网站有独立的验证码输入框：
1. 输入用户名（从 2Pass 复制）
2. 输入密码（从 2Pass 复制）
3. 输入验证码（查看 2Pass 的 TOTP 验证码）

#### 场景 2：组合密码系统

网站要求在密码框输入"密码+验证码"：
1. 输入用户名（从 2Pass 复制）
2. 点击"📋 复制组合密码"
3. 粘贴到密码框

### TOTP 故障排除

#### 问题：显示 ERROR 或错误信息

**原因**：TOTP 密钥格式不正确

**解决方法**：
1. 编辑密码条目
2. 点击"🔧 管理 TOTP"
3. 点击"🗑️ 移除 TOTP"
4. 重新配置，使用"生成密钥"而不是手动输入

#### 问题：验证码与 Google Authenticator 不一致

**原因**：系统时间不同步

**解决方法**：
- 检查系统时间设置
- Mac: 系统设置 → 通用 → 日期与时间 → 自动设置

#### 问题：生成测试验证码没反应

**原因**：还没有生成密钥

**解决方法**：
1. 先点击"🔑 生成密钥"
2. 看到密钥显示后
3. 再点击"🧪 生成测试验证码"

### Base32 编码说明

TOTP 密钥使用 Base32 编码：

**允许的字符**：
- 大写字母 A-Z
- 数字 2-7
- 等号 =（填充）

**不允许的字符**：
- 数字 0、1、8、9
- 小写字母（会自动转大写）
- 其他符号

**正确示例**：
- `JBSWY3DPEHPK3PXP`
- `JBSWY3DPEHPK3PXP========`

**错误示例**：
- `abc123`（小写，包含 0、1）
- `29657ADE-6B74...`（UUID 格式）

---

## 侧边栏使用

### 基本操作

#### 切换视图
点击侧边栏菜单项：
- 🔐 **密码管理** - 查看密码列表
- 🎲 **密码生成器** - 独立的密码生成工具
- ⚙️ **设置** - 应用设置
- ℹ️ **关于** - 应用信息

#### 折叠/展开
- 点击 ◀ 按钮 → 折叠（70px）
- 点击 ▶ 按钮 → 展开（恢复上次宽度）

### 拖动调整宽度

#### 如何拖动

1. **找到拖动手柄**
   - 将鼠标移到侧边栏右边缘
   - 看到竖线和 ↔ 光标

2. **拖动调整**
   - 按住鼠标左键
   - 向右拖动 → 变宽
   - 向左拖动 → 变窄
   - 松开鼠标 → 固定宽度

3. **自动保存**
   - 调整后的宽度会自动保存
   - 下次启动自动恢复

#### 宽度限制

| 宽度 | 说明 |
|------|------|
| < 150px | 自动折叠到 70px |
| 180px | 最小宽度 |
| 260px | 默认宽度（推荐）|
| 400px | 最大宽度 |

#### 拖动技巧

**快速折叠**：
- 向左拖到边缘
- 自动折叠 ✓

**精确调整**：
- 慢慢拖动
- 精确到 1px

**重置宽度**：
- 打开浏览器控制台（F12）
- 输入：`localStorage.removeItem("sidebarWidth")`
- 刷新应用

#### 推荐宽度

- **小屏幕**（< 1366px）：180-240px
- **中等屏幕**（1366-1920px）：240-300px
- **大屏幕**（> 1920px）：300-400px

---

## 故障排除

### 常见问题

#### 1. 忘记主密码

**问题**：无法登录应用

**解决方法**：
- ⚠️ 主密码无法恢复
- 需要删除数据文件重新开始
- 位置：`~/Library/Application Support/com.2pass.2pass/data.json`

#### 2. TOTP 验证码错误

**问题**：验证码显示 ERROR

**解决方法**：
1. 删除该密码条目
2. 重新创建
3. 使用"生成密钥"而非手动输入
4. 确保系统时间正确

#### 3. 拖动侧边栏没反应

**问题**：无法拖动调整宽度

**解决方法**：
- 确保侧边栏是展开状态（折叠时无法拖动）
- 鼠标要在右边缘（8px 宽的感应区）
- 尝试刷新应用

#### 4. 复制功能不工作

**问题**：点击复制按钮无反应

**解决方法**：
- 检查浏览器剪贴板权限
- 某些平台可能需要用户授权

### 数据相关

#### 数据存储位置

- **macOS**: `~/Library/Application Support/com.2pass.2pass/data.json`
- **Windows**: `%APPDATA%\2pass\2pass\data\data.json`
- **Linux**: `~/.local/share/2pass/data.json`

#### 备份数据

手动复制数据文件到安全位置：

```bash
# macOS
cp ~/Library/Application\ Support/com.2pass.2pass/data.json ~/Desktop/2pass-backup.json
```

#### 恢复数据

将备份文件复制回原位置：

```bash
# macOS
cp ~/Desktop/2pass-backup.json ~/Library/Application\ Support/com.2pass.2pass/data.json
```

#### 清除所有数据

```bash
# macOS
rm -f ~/Library/Application\ Support/com.2pass.2pass/data.json
```

然后重启应用，会提示创建新的主密码。

### 开发调试

#### 查看日志

**浏览器控制台**：
- Mac: `Command + Option + I`
- Windows/Linux: `F12`

**终端输出**：
- 查看运行 `pnpm tauri dev` 的终端
- Rust 日志会显示在这里

#### 清理缓存

```bash
# 清理 Rust 编译缓存
cargo clean --manifest-path src-tauri/Cargo.toml

# 清理 Node 模块
rm -rf node_modules
pnpm install
```

---

## 技术说明

### 加密技术

**数据加密**：
- 算法：AES-256-GCM
- 模式：认证加密（AEAD）
- 每次加密使用新的 nonce

**密码哈希**：
- 算法：Argon2id
- 参数：默认安全参数
- 随机盐值（每个密码不同）

**密钥派生**：
- 从主密码派生 256 位加密密钥
- 使用 Argon2id
- 固定盐值（建议生产环境更换）

**TOTP 生成**：
- 算法：HMAC-SHA1
- 时间步长：30 秒
- 验证码长度：6 位数

### 技术栈

**前端**：
- React 19
- TypeScript
- Vite
- CSS3

**后端**：
- Tauri 2.0
- Rust
- aes-gcm（加密）
- argon2（哈希）
- totp-lite（TOTP）
- data-encoding（Base32）

### 安全建议

1. ⚠️ **修改生产盐值**
   - 文件：`src-tauri/src/lib.rs`
   - 位置：`derive_key` 函数中的固定盐值
   - 改为你自己的随机值

2. ⚠️ **定期备份**
   - 至少每周备份一次数据文件
   - 保存到安全位置（如加密 U 盘）

3. ⚠️ **使用强主密码**
   - 至少 12 个字符
   - 包含大小写、数字、符号
   - 不要使用常见密码

4. ⚠️ **保护数据文件**
   - 不要分享数据文件
   - 不要上传到云端（除非额外加密）

---

## 快速参考

### 快捷键（计划中）

当前版本暂无快捷键，未来版本会添加：
- `Ctrl/Cmd + F` - 搜索
- `Ctrl/Cmd + N` - 新建密码
- `Ctrl/Cmd + ,` - 设置
- `Esc` - 关闭弹窗

### 常用操作

| 操作 | 步骤 |
|------|------|
| 添加密码 | 点击"➕ 添加密码" |
| 搜索密码 | 在顶部搜索框输入 |
| 复制密码 | 点击密码旁的 📋 |
| 查看密码 | 点击 👁️ |
| 生成密码 | 点击密码输入框旁的 🎲 |
| 配置 TOTP | 点击"➕ 添加 TOTP" |
| 复制组合密码 | 点击组合密码的 📋 |
| 调整侧边栏 | 拖动右边缘 |
| 折叠侧边栏 | 点击 ◀ 或拖到 < 150px |
| 拖动排序 | 悬停卡片看到 ⋮⋮ 后拖动 |

### TOTP 快速测试

使用标准测试密钥验证功能：

**测试密钥**：`JBSWY3DPEHPK3PXP`

1. 添加密码 → 配置 TOTP
2. 选择"✍️ 手动输入密钥"
3. 输入上述测试密钥
4. 生成测试验证码
5. 应该能看到 6 位数字 ✓

### 界面说明

```
┌──────────────┬────────────────────────────┐
│ 🔐 2Pass  ◀ │  主内容区域                │
├──────────────┤                            │
│ 🔐 密码管理 │  - 密码卡片网格            │
│ 🎲 密码生成 │  - 搜索栏                  │
│ ⚙️ 设置     │  - 添加按钮                │
│ ℹ️ 关于     │  - TOTP 验证码显示         │
│              │                            │
├──────────────┤                            │
│ 👤 已解锁   │                            │
└──────────────┴────────────────────────────┘
    ↑ 可拖动调整宽度
```

---

## 最佳实践

### 密码管理

1. **使用强密码**
   - 利用密码生成器
   - 至少 16 个字符
   - 包含各种字符类型

2. **合理分类**
   - 使用清晰的标题
   - 添加网址便于识别
   - 使用备注记录额外信息

3. **定期更新**
   - 定期更换重要密码
   - 编辑条目更新密码

### TOTP 使用

1. **多设备备份**
   - 在多个设备上扫描同一个二维码
   - 作为备份方案

2. **保存密钥**
   - 复制 Base32 密钥到安全位置
   - 以防手机丢失

3. **验证配置**
   - 配置后立即测试
   - 确保验证码正确

### 数据安全

1. **定期备份**
   - 每周备份数据文件
   - 保存到多个位置

2. **安全存储**
   - 不要明文保存主密码
   - 数据文件不要分享

3. **环境隔离**
   - 开发和生产使用不同主密码
   - 测试数据及时清理

---

## 更新日志

### v1.2.0 (2025-11-05)

**新功能**：
- ✅ 可拖动调整侧边栏宽度
- ✅ 宽度自动保存和恢复
- ✅ 智能折叠阈值
- ✅ 组合密码默认隐藏
- ✅ 组合密码按钮一行显示

**改进**：
- ✅ TOTP 错误处理优化
- ✅ Base32 编码兼容性
- ✅ 拖动手柄视觉反馈
- ✅ 响应式布局优化

### v1.1.0

**新功能**：
- ✅ TOTP 支持
- ✅ 组合密码功能
- ✅ 侧边栏导航
- ✅ 多视图切换

### v1.0.0

**核心功能**：
- ✅ 密码管理 CRUD
- ✅ AES-256 加密
- ✅ 密码生成器
- ✅ 搜索功能

---

## 联系和支持

### 报告问题

如果遇到 bug 或有功能建议：
1. 记录详细的复现步骤
2. 截图或复制错误信息
3. 查看浏览器控制台日志

### 功能建议

未来可能添加的功能：
- [ ] 导出/导入功能
- [ ] 密码强度检查
- [ ] 暗色主题
- [ ] 更改主密码
- [ ] 自动锁定
- [ ] 浏览器扩展

---

## 附录

### 常用命令

```bash
# 开发
pnpm tauri dev

# 构建
pnpm tauri build

# 清理
cargo clean --manifest-path src-tauri/Cargo.toml

# 查看数据文件
cat ~/Library/Application\ Support/com.2pass.2pass/data.json

# 删除数据
rm -f ~/Library/Application\ Support/com.2pass.2pass/data.json
```

### 浏览器控制台命令

```javascript
// 清除侧边栏宽度设置
localStorage.removeItem("sidebarWidth");

// 查看当前宽度
localStorage.getItem("sidebarWidth");

// 直接调用 Rust 命令测试
const { invoke } = window.__TAURI__.tauri;
invoke('generate_totp_secret').then(console.log);
```

### 文件路径

| 类型 | 路径 |
|------|------|
| 数据文件 | `~/Library/Application Support/com.2pass.2pass/data.json` |
| 侧边栏设置 | `localStorage.sidebarWidth` |
| 源代码 | `/Users/dorian/Dev/workspace/tauri/2pass` |

---

## 结语

感谢使用 2Pass 密码管理器！

这是一个安全、现代、功能完整的密码管理应用。所有数据都加密存储在本地，你的隐私得到完全保护。

**记住**：
- 🔑 主密码是访问一切的钥匙
- 💾 定期备份数据文件
- 🔒 不要分享主密码和数据文件

**享受安全的密码管理体验！** 🎉

---

**文档版本**：v1.2.0  
**最后更新**：2025-11-05  
**开发者**：Dorian

